(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f16ac04"],{"1a68":function(t,e,i){"use strict";i.d(e,"d",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a})),i.d(e,"e",(function(){return r})),i.d(e,"b",(function(){return c}));var s=i("b775");function o(t){return Object(s["a"])({url:"/visits",method:"get",params:t})}function n(t){return Object(s["a"])({url:"/visits/".concat(t),method:"get"})}function a(t){return Object(s["a"])({url:"/visits",method:"post",data:t})}function r(t,e){return Object(s["a"])({url:"/visits/".concat(t),method:"put",data:e})}function c(t){return Object(s["a"])({url:"/visits/".concat(t),method:"delete"})}},8024:function(t,e,i){"use strict";i.d(e,"e",(function(){return o})),i.d(e,"b",(function(){return n})),i.d(e,"d",(function(){return a})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return c})),i.d(e,"f",(function(){return d}));var s=i("b775");function o(){return Object(s["a"])({url:"/selections/provinces",method:"get"})}function n(t){return Object(s["a"])({url:"/selections/cities/".concat(t),method:"get"})}function a(){return Object(s["a"])({url:"/selections/customers",method:"get"})}function r(t){return Object(s["a"])({url:"/selections/contactors/".concat(t),method:"get"})}function c(t){return Object(s["a"])({url:"/selections/addresses/".concat(t),method:"get"})}function d(){return Object(s["a"])({url:"/selections/visittypes",method:"get"})}},"8c34":function(t,e,i){"use strict";var s=i("d128"),o=i.n(s);o.a},bc50:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{staticClass:"px-4 py-0",attrs:{fluid:""},scopedSlots:t._u([{key:"after-heading",fn:function(){},proxy:!0}])},[i("v-card",{staticClass:"pt-6",attrs:{"min-height":"760px"}},[i("v-card-actions",[i("v-spacer"),t.isEdit&&0===t.temp.status_code&&t.isAuthor(t.temp.author_id)?i("div",{attrs:{align:"center",justify:"center"}},[i("upload-picture-dialog")],1):t._e(),i("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit&&0===t.temp.status_code&&t.isAuthor(t.temp.author_id),expression:"!isEdit && temp.status_code === 0 && isAuthor(temp.author_id)"}],attrs:{color:"warning"},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v("修改"),i("v-icon",{attrs:{right:""}},[t._v("mdi-text-box-edit")])],1),i("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit&&0===t.temp.status_code&&t.isAuthor(t.temp.author_id),expression:"!isEdit && temp.status_code === 0 && isAuthor(temp.author_id)"}],attrs:{color:"primary"},on:{click:t.submitAudit}},[t._v("提交"),i("v-icon",{attrs:{right:""}},[t._v("mdi-check-bold")])],1),i("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit&&1===t.temp.status_code&&t.isAuthor(t.temp.author_id),expression:"!isEdit && temp.status_code === 1 && isAuthor(temp.author_id)"}],attrs:{color:"warning"},on:{click:t.cancelAudit}},[t._v("撤回"),i("v-icon",{attrs:{right:""}},[t._v("mdi-check-bold")])],1),i("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],attrs:{color:"info"},on:{click:t.cancelEdit}},[i("v-icon",[t._v("mdi-close-outline ")])],1),i("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],attrs:{color:"green"},on:{click:t.confirmEdit}},[i("v-icon",{attrs:{text:""}},[t._v("mdi-check-outline")])],1)],1),i("div",{staticClass:"px-10 pb-5"},[i("v-row",[i("v-col",{attrs:{cols:"12",md:"7"}},[i("v-row",[i("v-col",{attrs:{cols:"12",md:"10"}},[i("v-text-field",{attrs:{color:"yellow darken-3",label:"客户名称",hint:"",required:"",disabled:"","prepend-icon":"mdi-account-group"},model:{value:t.temp.customer_name,callback:function(e){t.$set(t.temp,"customer_name",e)},expression:"temp.customer_name"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",md:"6"}},[i("v-text-field",{attrs:{color:"yellow darken-3",label:"标题",hint:"简述此次拜访目的",required:"",disabled:!t.isEdit,"prepend-icon":"mdi-subtitles"},model:{value:t.temp.title,callback:function(e){t.$set(t.temp,"title",e)},expression:"temp.title"}})],1),i("v-col",{attrs:{cols:"12",md:"2"}},[i("v-text-field",{attrs:{color:"yellow darken-3",label:"创建者",required:"",disabled:"","prepend-icon":"mdi-account"},model:{value:t.temp.author.name,callback:function(e){t.$set(t.temp.author,"name",e)},expression:"temp.author.name"}})],1),i("v-col",{attrs:{cols:"12",md:"2"}},[i("v-autocomplete",{attrs:{items:t.statusCodes,"item-text":"display_name","item-value":"key",label:"当前状态",placeholder:"","prepend-icon":"mdi-alpha-s-box",disabled:""},model:{value:t.temp.status_code,callback:function(e){t.$set(t.temp,"status_code",e)},expression:"temp.status_code"}})],1)],1),i("v-row",[i("v-col",[i("v-textarea",{attrs:{color:"yellow darken-3",label:"描述拜访经过和成果",hint:"",required:"",disabled:!t.isEdit,"prepend-icon":"mdi-content-copy","auto-grow":""},model:{value:t.temp.description,callback:function(e){t.$set(t.temp,"description",e)},expression:"temp.description"}})],1)],1),i("v-row",[i("v-col",[i("v-autocomplete",{attrs:{items:t.contactors,"item-text":"name","item-value":"id",label:"联系人",placeholder:"本次拜访接待人员","prepend-icon":"mdi-account-search-outline",multiple:"",chips:"",disabled:!t.isEdit},model:{value:t.temp.contactorids,callback:function(e){t.$set(t.temp,"contactorids",e)},expression:"temp.contactorids"}})],1)],1),i("v-row",[i("v-col",[i("v-autocomplete",{attrs:{items:t.addresses,"item-text":"name","item-value":"id",label:"拜访地址",placeholder:"本次拜访会面地址","prepend-icon":"mdi-account-search",disabled:!t.isEdit},model:{value:t.temp.address_id,callback:function(e){t.$set(t.temp,"address_id",e)},expression:"temp.address_id"}})],1)],1),t.temp.order?i("v-row",t._l(t.temp.order.orderrecs,(function(e,s){return i("v-col",{key:s},[i("v-row",[e.auditor?i("v-text-field",{attrs:{color:"yellow darken-3",label:"审批人",required:"",disabled:"","prepend-icon":"mdi-subtitles"},model:{value:e.auditor.name,callback:function(i){t.$set(e.auditor,"name",i)},expression:"orderrec.auditor.name"}}):t._e(),i("v-text-field",{attrs:{color:"yellow darken-3",label:"意见",required:"",disabled:"","prepend-icon":"mdi-subtitles"},model:{value:e.opinion_text,callback:function(i){t.$set(e,"opinion_text",i)},expression:"orderrec.opinion_text"}})],1)],1)})),1):t._e()],1),i("v-col",{attrs:{cols:"12",md:"5"}},[i("v-carousel",{attrs:{cycle:"",height:"600","show-arrows-on-hover":"","delimiter-icon":"mdi-minus"}},t._l(t.temp.attachments,(function(t,e){return i("v-carousel-item",{key:e},[i("v-row",{staticClass:"fill-height",attrs:{align:"center",justify:"center"}},[i("v-img",{attrs:{"max-height":"600",src:t.uri}})],1)],1)})),1)],1)],1)],1)],1)],1)},o=[],n=(i("4160"),i("caad"),i("4e827"),i("d3b7"),i("2532"),i("159b"),i("1a68")),a=i("8024"),r=[{key:0,display_name:"新建"},{key:1,display_name:"提审"},{key:3,display_name:"完成"},{key:9,display_name:"驳回"}],c={name:"VisitDetails",components:{UploadPictureDialog:function(){return i.e("chunk-3972598e").then(i.bind(null,"939f"))}},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},data:function(){return{listLoading:!1,contactors:[],addresses:[],visittypes:[],statusCodes:r,details:null,temp:{author:"",attachments:[],order:{orderrecs:[]}},rules:{},users:[],isEdit:!1}},computed:{isAdminRole:function(){return!!this.$store.getters.roles.includes("admin")}},created:function(){this.fetchData(),this.getVisittypesList()},methods:{goBack:function(){this.$router.go(-1)},isAuthor:function(t){var e=this.$store.getters.userId;return e===t},fetchData:function(){var t=this;this.listLoading=!0;var e=this.$route.params&&this.$route.params.id;Object(n["c"])(e).then((function(e){t.temp=e.data,t.getContactorsListbyCustomerId(t.temp.customer_id),t.getAddressesListbyCustomerId(t.temp.customer_id),setTimeout((function(){t.listLoading=!1}),5e3)}))},submitAudit:function(){var t=this;this.listLoading=!0;var e=this.$route.params&&this.$route.params.id,i={status_code:1};this.$confirm("确认日志填写已完整并要提交审核?").then((function(s){s&&Object(n["e"])(e,i).then((function(e){t.temp=e.data,setTimeout((function(){t.listLoading=!1}),5e3)}))}))},cancelAudit:function(){var t=this;this.listLoading=!0;var e=this.$route.params&&this.$route.params.id,i={status_code:0};this.$confirm("确认撤销日志审核?").then((function(s){s&&Object(n["e"])(e,i).then((function(e){t.temp=e.data,setTimeout((function(){t.listLoading=!1}),5e3)}))}))},getContactorsListbyCustomerId:function(t){var e=this;Object(a["c"])(t).then((function(t){e.contactors=t.data.items,setTimeout((function(){e.listLoading=!1}),1500)}))},getAddressesListbyCustomerId:function(t){var e=this;Object(a["a"])(t).then((function(t){e.addresses=t.data.items,setTimeout((function(){e.listLoading=!1}),1500)}))},getVisittypesList:function(){var t=this;Object(a["f"])().then((function(e){t.visittypes=e.data.items,setTimeout((function(){t.listLoading=!1}),1500)}))},confirmEdit:function(){var t=this;this.listLoading=!0;var e=this.$route.params&&this.$route.params.id;Object(n["e"])(e,this.temp).then((function(e){t.temp=e.data,setTimeout((function(){t.listLoading=!1}),5e3)})),this.isEdit=!this.isEdit},getNamefromOptions:function(t,e){var i="";return t.forEach((function(t){t.key===e&&(i=t.display_name)})),i},cancelEdit:function(){this.isEdit=!this.isEdit,this.fetchData()},getSortClass:function(t){var e=this.listQuery.sort;return e==="+".concat(t)?"ascending":"descending"}}},d=c,u=(i("8c34"),i("2877")),l=i("6544"),m=i.n(l),p=i("c6a6"),h=i("8336"),v=i("b0af"),f=i("99d9"),b=i("5e66"),g=i("3e35"),_=i("62ad"),w=i("a523"),x=i("132d"),y=i("adda"),k=i("0fd9"),E=i("2fa4"),$=i("8654"),j=i("a844"),O=Object(u["a"])(d,s,o,!1,null,"44e28ce6",null);e["default"]=O.exports;m()(O,{VAutocomplete:p["a"],VBtn:h["a"],VCard:v["a"],VCardActions:f["b"],VCarousel:b["a"],VCarouselItem:g["a"],VCol:_["a"],VContainer:w["a"],VIcon:x["a"],VImg:y["a"],VRow:k["a"],VSpacer:E["a"],VTextField:$["a"],VTextarea:j["a"]})},d128:function(t,e,i){}}]);
//# sourceMappingURL=chunk-6f16ac04.9f061395.js.map