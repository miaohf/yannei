{"remainingRequest":"D:\\mycode\\Yanei\\front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\mycode\\Yanei\\front-end\\src\\views\\dashboard\\customers\\List.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\mycode\\Yanei\\front-end\\src\\views\\dashboard\\customers\\List.vue","mtime":1655459419951},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668947705996},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1668956708481},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668947705996},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1668956821544}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7CiAgZmV0Y2hDdXN0b21lcnMsCiAgLy8gdXBkYXRlQ3VzdG9tZXIsCiAgZGVsZXRlQ3VzdG9tZXIsCn0gZnJvbSAnQC9hcGkvY3VzdG9tZXJzJwoKY29uc3QgYmF0Y2hDb2RlT3B0aW9ucyA9IFtdCgpjb25zdCB2aWxsYWdlc09wdGlvbnMgPSBbXQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDb250cmFjdHMnLAoKICBjb21wb25lbnRzOiB7CiAgICBBZGRDdXN0b21lckRpYWxvZzogKCkgPT4gaW1wb3J0KCcuL2FkZEN1c3RvbWVyRGlhbG9nJyksCiAgfSwKCiAgZGF0YTogKCkgPT4gKHsKICAgIHNuYWNrYmFyOiBmYWxzZSwKICAgIHRleHQ6ICcnLAogICAgdGltZW91dDogMzAwMCwKICAgIHBhbmVsOiBbMCwgMV0sCiAgICBpY29uczogewogICAgICBkb2M6IHsKICAgICAgICBjb2xvcjogJ2JsdWUnLAogICAgICAgIGljb246ICdtZGktZmlsZS1kb2N1bWVudCcsCiAgICAgIH0sCiAgICAgIGRlbGV0ZTogewogICAgICAgIGNvbG9yOiAnd2FybmluZycsCiAgICAgICAgaWNvbjogJ21kaS10cmFzaC1jYW4nLAogICAgICB9LAogICAgfSwKICAgIGV4cG9ydEl0ZW1zOiBbXSwKICAgIGl0ZW1zOiBbXSwKICAgIGxpc3RRdWVyeTogewogICAgICBwYWdlOiAxLAogICAgICBsaW1pdDogMTAsCiAgICAgIGtleXdvcmQ6IHVuZGVmaW5lZCwKICAgICAgYWN0aXZpdHk6IHVuZGVmaW5lZCwKICAgICAgYmF0Y2hfY29kZTogdW5kZWZpbmVkLAogICAgICBzb3J0OiAnK2lkJywKICAgICAgb3JkZXJieV9pZF9kZXNjOiB1bmRlZmluZWQsCiAgICB9LAogICAgc2VhcmNoOiAnJywKICAgIGF3YWl0aW5nU2VhcmNoOiBmYWxzZSwKICAgIGNpcmNsZTogdHJ1ZSwKICAgIGRpc2FibGVkOiBmYWxzZSwKICAgIGxlbmd0aDogMTAsCiAgICBuZXh0SWNvbjogJ21kaS1jaGV2cm9uLXJpZ2h0JywKICAgIHByZXZJY29uOiAnbWRpLWNoZXZyb24tbGVmdCcsCiAgICB0b3RhbFZpc2libGU6IDEwLAogICAgdG90YWxfcGFnZXM6IDAsCiAgICBleHBvcnRGaWVsZHM6IHt9LAoKICAgIGdyZWVuQ29sb3I6ICdyZ2IoODEsIDE4NSwgMTE2KScsCiAgICB3YXJuaW5nQ29sb3I6ICdyZ2IoMjQxLCAyMTEsIDE3MSknLAogICAgYmF0Y2hDb2RlT3B0aW9ucywKICAgIHZpbGxhZ2VzT3B0aW9ucywKICB9KSwKCiAgY29tcHV0ZWQ6IHsKICAgIGlzQWRtaW5Sb2xlKCkgewogICAgICBpZiAodGhpcy4kc3RvcmUuZ2V0dGVycy5yb2xlLnNsdWcgPT09ICdhZG1pbmlzdHJhdG9yJykgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgIH0sCiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0TGlzdCgpCiAgICBjb25zb2xlLmxvZyhEYXRlLm5vdygpKQogIH0sCgogIC8vIGV2ZW50czogewogIC8vICAgZXZlbnRHZXRsaXN0OiBmdW5jdGlvbihkYXRhKSB7CiAgLy8gICAgIGNvbnNvbGUubG9nKCdldmVudEdldGxpc3QnKQogIC8vICAgfQogIC8vIH0sCiAgLy8gd2F0Y2g6IHsKICAvLyAgICAgc2VhcmNoOiBmdW5jdGlvbiAodmFsKSB7CiAgLy8gICAgICAgaWYgKCF0aGlzLmF3YWl0aW5nU2VhcmNoKSB7CiAgLy8gICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAvLyAgICAgICAgICAgdGhpcy5nZXRMaXN0KCkKICAvLyAgICAgICAgICAgdGhpcy5hd2FpdGluZ1NlYXJjaCA9IGZhbHNlCiAgLy8gICAgICAgICB9LCAxNTAwKTsgLy8gMSBzZWMgZGVsYXkKICAvLyAgICAgICB9CiAgLy8gICAgICAgdGhpcy5hd2FpdGluZ1NlYXJjaCA9IHRydWUKICAvLyAgICAgfSwKICAvLyAgIH0sCiAgbWV0aG9kczogewogICAgaGFuZGxlVG9EZXRhaWxzKHJvdykgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgbmFtZTogJ0N1c3RvbWVyRGV0YWlscycsCiAgICAgICAgcGFyYW1zOiB7IGlkOiByb3cuaWQgfSwKICAgICAgfSkKICAgIH0sCiAgICBnZXRRdWVyeSgpIHsKICAgICAgdGhpcy5saXN0UXVlcnkucGFnZSA9IDEKICAgICAgdGhpcy5nZXRMaXN0KCkKICAgIH0sCgogICAgZ2V0TGlzdCgpIHsKICAgICAgdGhpcy5saXN0TG9hZGluZyA9IHRydWUKICAgICAgdGhpcy5saXN0UXVlcnkubGltaXQgPSAxMAogICAgICAvLyB0aGlzLmxpc3RRdWVyeS5rZXl3b3JkID0gdGhpcy5zZWFyY2gKCiAgICAgIGZldGNoQ3VzdG9tZXJzKHRoaXMubGlzdFF1ZXJ5KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLml0ZW1zID0gcmVzcG9uc2UuZGF0YS5pdGVtcwogICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLl9tZXRhLnRvdGFsX3BhZ2VzCgogICAgICAgIC8vIEp1c3QgdG8gc2ltdWxhdGUgdGhlIHRpbWUgb2YgdGhlIHJlcXVlc3QKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMubGlzdExvYWRpbmcgPSBmYWxzZQogICAgICAgIH0sIDEuNSAqIDEwMDApCiAgICAgIH0pCiAgICB9LAoKICAgIGdldExpc3Rmb3JFeHBvcnQoKSB7CiAgICAgIHRoaXMubGlzdExvYWRpbmcgPSB0cnVlCiAgICAgIHRoaXMubGlzdFF1ZXJ5LmxpbWl0ID0gMTAwMDAKICAgICAgZmV0Y2hDdXN0b21lcnModGhpcy5saXN0UXVlcnkpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIHRoaXMuZXhwb3J0SXRlbXMgPSByZXNwb25zZS5kYXRhLml0ZW1zCiAgICAgICAgLy8gSnVzdCB0byBzaW11bGF0ZSB0aGUgdGltZSBvZiB0aGUgcmVxdWVzdAogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5saXN0TG9hZGluZyA9IGZhbHNlCiAgICAgICAgfSwgMS41ICogMTAwMCkKICAgICAgfSkKICAgICAgcmV0dXJuIHRoaXMuZXhwb3J0SXRlbXMKICAgIH0sCgogICAgcmVzZXRRdWVyeSgpIHsKICAgICAgdGhpcy5saXN0UXVlcnkua2V5d29yZCA9IHVuZGVmaW5lZAogICAgICB0aGlzLmxpc3RRdWVyeS5iYXRjaF9jb2RlID0gdW5kZWZpbmVkCiAgICAgIHRoaXMubGlzdFF1ZXJ5LmxpbWl0ID0gMTAKICAgIH0sCgogICAgcmVtb3ZlQ3VzdG9tZXIocm93KSB7CiAgICAgIHRoaXMuJGNvbmZpcm0oJ+ehruiupOWIoOmZpOWuouaIt+aho+ahiD8nKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgZGVsZXRlQ3VzdG9tZXIocm93LmlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgdGhpcy5nZXRMaXN0KCkKICAgICAgICAgICAgLy8gSnVzdCB0byBzaW11bGF0ZSB0aGUgdGltZSBvZiB0aGUgcmVxdWVzdAogICAgICAgICAgICB0aGlzLnRleHQgPSAn5a6i5oi35qGj5qGI5Yig6Zmk5oiQ5Yqf77yBJwogICAgICAgICAgICB0aGlzLnNuYWNrYmFyID0gdHJ1ZQogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgcGFnaW5hdGlvbkNoYW5nZUhhbmRsZXIocGFnZU51bWJlcikgewogICAgICB0aGlzLmxpc3RRdWVyeS5wYWdlID0gcGFnZU51bWJlcgogICAgICB0aGlzLmdldExpc3QoKQogICAgfSwKICAgIC8vIHJlc2V0KCkgewogICAgLy8gICB0aGlzLiRyZWZzLmZvcm0ucmVzZXQoKQogICAgLy8gfSwKICAgIC8vIHJlc2V0VmFsaWRhdGlvbigpIHsKICAgIC8vICAgdGhpcy4kcmVmcy5mb3JtLnJlc2V0VmFsaWRhdGlvbigpCiAgICAvLyB9LAogIH0sCn0K"},{"version":3,"sources":["List.vue"],"names":[],"mappings":";AAoJA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"List.vue","sourceRoot":"src/views/dashboard/customers","sourcesContent":["<template>\n  <v-container fluid class=\"px-4 py-0\">\n    <template v-slot:after-heading> </template>\n    <v-row class=\"d-flex justify-space-between mx-1\">\n      <div>\n        <v-row>\n          <v-switch\n            v-model=\"listQuery.orderby_id_desc\"\n            label=\"倒序\"\n            style=\"max-width: 100px;\"\n            class=\"mx-3\"\n          ></v-switch>\n\n          <v-select\n            v-model=\"listQuery.village_id\"\n            :items=\"villagesOptions\"\n            item-text=\"display_name\"\n            item-value=\"key\"\n            menu-props=\"auto\"\n            hide-details\n            label=\"选择城市\"\n            single-line\n            class=\"mx-3\"\n            style=\"max-width: 80px;\"\n          ></v-select>\n\n          <v-text-field\n            v-model=\"listQuery.keyword\"\n            label=\"公司或单位名称\"\n            hide-details\n            single-line\n            class=\"mx-3\"\n            style=\"max-width: 120px;\"\n          />\n        </v-row>\n      </div>\n      <div>\n        <v-row class=\"mx-2 mb-3\"\n          ><v-btn color=\"primary\" class=\"mx-1 my-2\" @click=\"getQuery\">\n            查询\n            <v-icon right>mdi-magnify</v-icon>\n          </v-btn>\n\n          <v-btn color=\"primary\" class=\"mx-1 mx-1 my-2\" @click=\"resetQuery\">\n            重置\n            <v-icon right>mdi-lock-reset</v-icon>\n          </v-btn>\n\n          <export-excel\n            :fields=\"exportFields\"\n            worksheet=\"客户数据\"\n            name=\"研一.xls\"\n            :fetch=\"getListforExport\"\n          >\n            <v-btn color=\"primary\" class=\"mx-1 mx-1 my-2\">\n              导出\n              <v-icon right>mdi-arrow-down-bold-circle-outline</v-icon>\n            </v-btn>\n          </export-excel>\n\n          <div>\n            <add-customer-dialog />\n          </div>\n        </v-row>\n      </div>\n    </v-row>\n\n    <v-simple-table fixed-header class=\"pa-3\" height=\"735px\">\n      <template v-slot:default>\n        <thead>\n          <tr>\n            <th>ID</th>\n            <th>客户名称</th>\n            <th>所在城市</th>\n            <th>公司电话</th>\n            <th>综合描述</th>\n            <th>创建时间</th>\n            <th>最后更新</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"row in items\" :key=\"row.id\">\n            <td\n              class=\"font-weight-light grey--text text-left\"\n              style=\"font-size:11px\"\n            >\n              {{ row.id }}\n            </td>\n            <td class=\"text-left\">\n              {{ row.name | truncate(20) }}\n            </td>\n            <td class=\"text-left\">\n              {{ row.city_name }}\n            </td>\n            <td class=\"text-left\">\n              {{ row.phone }}\n            </td>\n            <td class=\"text-left\">\n              {{ row.description | truncate(40) }}\n            </td>\n            <td class=\"text-left\">\n              {{ $moment(row.create_at).format('YYYY-MM-DD HH:mm:ss') }}\n            </td>\n            <td class=\"text-left\">\n              {{ $moment(row.last_update).format('YYYY-MM-DD HH:mm:ss') }}\n              <v-btn\n                :color=\"icons.doc.color\"\n                icon\n                fab\n                x-small\n                @click=\"handleToDetails(row)\"\n              >\n                <v-icon right v-text=\"icons.doc.icon\" />\n              </v-btn>\n              <v-btn\n                v-if=\"isAdminRole\"\n                :color=\"icons.delete.color\"\n                icon\n                fab\n                x-small\n                @click=\"removeCustomer(row)\"\n              >\n                <v-icon right v-text=\"icons.delete.icon\" />\n              </v-btn>\n            </td>\n          </tr>\n        </tbody>\n      </template>\n    </v-simple-table>\n    <v-pagination\n      v-model=\"listQuery.page\"\n      :circle=\"circle\"\n      :disabled=\"disabled\"\n      :length=\"total_pages\"\n      :next-icon=\"nextIcon\"\n      :prev-icon=\"prevIcon\"\n      :total-visible=\"totalVisible\"\n      :value=\"listQuery.page\"\n      class=\"my-3\"\n      @input=\"paginationChangeHandler\"\n    ></v-pagination>\n    <v-snackbar v-model=\"snackbar\" :timeout=\"timeout\">\n      {{ text }}\n    </v-snackbar>\n  </v-container>\n</template>\n\n<script>\nimport {\n  fetchCustomers,\n  // updateCustomer,\n  deleteCustomer,\n} from '@/api/customers'\n\nconst batchCodeOptions = []\n\nconst villagesOptions = []\n\nexport default {\n  name: 'Contracts',\n\n  components: {\n    AddCustomerDialog: () => import('./addCustomerDialog'),\n  },\n\n  data: () => ({\n    snackbar: false,\n    text: '',\n    timeout: 3000,\n    panel: [0, 1],\n    icons: {\n      doc: {\n        color: 'blue',\n        icon: 'mdi-file-document',\n      },\n      delete: {\n        color: 'warning',\n        icon: 'mdi-trash-can',\n      },\n    },\n    exportItems: [],\n    items: [],\n    listQuery: {\n      page: 1,\n      limit: 10,\n      keyword: undefined,\n      activity: undefined,\n      batch_code: undefined,\n      sort: '+id',\n      orderby_id_desc: undefined,\n    },\n    search: '',\n    awaitingSearch: false,\n    circle: true,\n    disabled: false,\n    length: 10,\n    nextIcon: 'mdi-chevron-right',\n    prevIcon: 'mdi-chevron-left',\n    totalVisible: 10,\n    total_pages: 0,\n    exportFields: {},\n\n    greenColor: 'rgb(81, 185, 116)',\n    warningColor: 'rgb(241, 211, 171)',\n    batchCodeOptions,\n    villagesOptions,\n  }),\n\n  computed: {\n    isAdminRole() {\n      if (this.$store.getters.role.slug === 'administrator') {\n        return true\n      } else {\n        return false\n      }\n    },\n  },\n\n  created() {\n    this.getList()\n    console.log(Date.now())\n  },\n\n  // events: {\n  //   eventGetlist: function(data) {\n  //     console.log('eventGetlist')\n  //   }\n  // },\n  // watch: {\n  //     search: function (val) {\n  //       if (!this.awaitingSearch) {\n  //         setTimeout(() => {\n  //           this.getList()\n  //           this.awaitingSearch = false\n  //         }, 1500); // 1 sec delay\n  //       }\n  //       this.awaitingSearch = true\n  //     },\n  //   },\n  methods: {\n    handleToDetails(row) {\n      this.$router.push({\n        name: 'CustomerDetails',\n        params: { id: row.id },\n      })\n    },\n    getQuery() {\n      this.listQuery.page = 1\n      this.getList()\n    },\n\n    getList() {\n      this.listLoading = true\n      this.listQuery.limit = 10\n      // this.listQuery.keyword = this.search\n\n      fetchCustomers(this.listQuery).then(response => {\n        this.items = response.data.items\n        this.total_pages = response.data._meta.total_pages\n\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n    },\n\n    getListforExport() {\n      this.listLoading = true\n      this.listQuery.limit = 10000\n      fetchCustomers(this.listQuery).then(response => {\n        this.exportItems = response.data.items\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n      return this.exportItems\n    },\n\n    resetQuery() {\n      this.listQuery.keyword = undefined\n      this.listQuery.batch_code = undefined\n      this.listQuery.limit = 10\n    },\n\n    removeCustomer(row) {\n      this.$confirm('确认删除客户档案?').then(res => {\n        if (res) {\n          deleteCustomer(row.id).then(response => {\n            this.getList()\n            // Just to simulate the time of the request\n            this.text = '客户档案删除成功！'\n            this.snackbar = true\n          })\n        }\n      })\n    },\n    paginationChangeHandler(pageNumber) {\n      this.listQuery.page = pageNumber\n      this.getList()\n    },\n    // reset() {\n    //   this.$refs.form.reset()\n    // },\n    // resetValidation() {\n    //   this.$refs.form.resetValidation()\n    // },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\nth {\n  font-size: 12px !important;\n  font-weight: 800;\n}\n\n// .background-transparent {\n//   background-color: transparent !important;\n// }\n\ntr:hover {\n  background-color: #43b4dd !important;\n  color: rgb(255, 255, 255);\n}\n</style>\n"]}]}