{"remainingRequest":"D:\\mycode\\Yanei\\front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\mycode\\Yanei\\front-end\\src\\views\\dashboard\\settings\\users.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\mycode\\Yanei\\front-end\\src\\views\\dashboard\\settings\\users.vue","mtime":1655109872678},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668947705996},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1668956708481},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668947705996},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1668956821544}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IGZldGNoVXNlcnMsIGRlbGV0ZVVzZXIgfSBmcm9tICdAL2FwaS91c2VycycKCmNvbnN0IHVzZXJTdGF0dXNPcHRpb25zID0gWwogIHsga2V5OiAwLCBkaXNwbGF5X25hbWU6ICflvoXlrqHmoLgnIH0sCiAgeyBrZXk6IDEsIGRpc3BsYXlfbmFtZTogJ+ato+W4uCcgfSwKICB7IGtleTogMiwgZGlzcGxheV9uYW1lOiAn5pyq6YCa6L+HJyB9LAogIHsga2V5OiAzLCBkaXNwbGF5X25hbWU6ICfpqbPlm54nIH0sCl0KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXNlcnMnLAoKICBjb21wb25lbnRzOiB7fSwKCiAgZGF0YTogKCkgPT4gKHsKICAgIHNuYWNrYmFyOiBmYWxzZSwKICAgIHRleHQ6ICcnLAogICAgdGltZW91dDogMzAwMCwKCiAgICBhY3Rpb246IHsKICAgICAgY29sb3I6ICdpbmZvJywKICAgICAgaWNvbjogJ21kaS1ibHVyJywKICAgIH0sCiAgICBpdGVtczogW10sCiAgICBsaXN0UXVlcnk6IHsKICAgICAgcGFnZTogMSwKICAgICAgbGltaXQ6IDEwMCwKICAgICAgbmFtZTogdW5kZWZpbmVkLAogICAgICBzdGF0dXM6IHVuZGVmaW5lZCwKICAgICAgc29ydDogJytpZCcsCiAgICB9LAogICAgLy8gc2VhcmNoOiB1bmRlZmluZWQsCiAgICB1c2VyU3RhdHVzT3B0aW9ucywKICAgIGNpcmNsZTogdHJ1ZSwKICAgIGRpc2FibGVkOiBmYWxzZSwKICAgIGxlbmd0aDogMTAsCiAgICBuZXh0SWNvbjogJ21kaS1jaGV2cm9uLXJpZ2h0JywKICAgIHByZXZJY29uOiAnbWRpLWNoZXZyb24tbGVmdCcsCiAgICB0b3RhbFZpc2libGU6IDEwLAogICAgdG90YWxfcGFnZXM6IDAsCiAgfSksCiAgY29tcHV0ZWQ6IHsKICAgIGlzQWRtaW5Sb2xlKCkgewogICAgICBpZiAodGhpcy4kc3RvcmUuZ2V0dGVycy5yb2xlcy5pbmNsdWRlcygnYWRtaW4nKSkgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgc2VhcmNoOiBmdW5jdGlvbih2YWwpIHsKICAgICAgaWYgKCF0aGlzLmF3YWl0aW5nU2VhcmNoKSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmdldExpc3QoKQogICAgICAgICAgdGhpcy5hd2FpdGluZ1NlYXJjaCA9IGZhbHNlCiAgICAgICAgfSwgNjAwMCkgLy8gMSBzZWMgZGVsYXkKICAgICAgfQogICAgICB0aGlzLmF3YWl0aW5nU2VhcmNoID0gdHJ1ZQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldExpc3QoKQogICAgLy8gY29uc29sZS5sb2coKQogIH0sCiAgbWV0aG9kczogewogICAgZ2V0UXVlcnkoKSB7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5nZXRMaXN0KCksIDUwMCkKICAgIH0sCiAgICBnZXRMaXN0KCkgewogICAgICB0aGlzLmxpc3RMb2FkaW5nID0gdHJ1ZQogICAgICBmZXRjaFVzZXJzKHRoaXMubGlzdFF1ZXJ5KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICB0aGlzLml0ZW1zID0gcmVzcG9uc2UuZGF0YS5pdGVtcwogICAgICAgIHRoaXMudG90YWxfcGFnZXMgPSByZXNwb25zZS5kYXRhLl9tZXRhLnRvdGFsX3BhZ2VzCiAgICAgICAgY29uc29sZS5sb2codGhpcy5pdGVtcykKCiAgICAgICAgLy8gSnVzdCB0byBzaW11bGF0ZSB0aGUgdGltZSBvZiB0aGUgcmVxdWVzdAogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5saXN0TG9hZGluZyA9IGZhbHNlCiAgICAgICAgfSwgMS41ICogMTAwMCkKICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVUb0RldGFpbHMocm93KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKHJvdy5pZCkKICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICfor7vogIXor6bmg4UnLAogICAgICAgIHBhcmFtczogeyBpZDogcm93LmlkIH0sCiAgICAgIH0pCiAgICB9LAogICAgcmVtb3ZlQXV0aG9yKHJvdykgewogICAgICB0aGlzLiRjb25maXJtKCfnoa7orqTliKDpmaTor7vogIXotKblj7c/JykudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgIGRlbGV0ZVVzZXIocm93LmlkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgdGhpcy5nZXRMaXN0KCkKICAgICAgICAgICAgLy8gSnVzdCB0byBzaW11bGF0ZSB0aGUgdGltZSBvZiB0aGUgcmVxdWVzdAogICAgICAgICAgICB0aGlzLnRleHQgPSAn5L2c6ICF5Yig6Zmk5oiQ5Yqf77yBJwogICAgICAgICAgICB0aGlzLnNuYWNrYmFyID0gdHJ1ZQogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgZ2V0TmFtZWZyb21PcHRpb25zKG9wdGlvbnMsIGtleSkgewogICAgICAvLyByZXR1cm4gb3B0aW9uc1trZXldCiAgICAgIGxldCBzaG93bmFtZSA9ICcnCiAgICAgIG9wdGlvbnMuZm9yRWFjaChpdGVtID0+IHsKICAgICAgICBpZiAoaXRlbS5rZXkgPT09IGtleSkgewogICAgICAgICAgLy8gY29uc29sZS5sb2coa2V5LCBpdGVtLmtleSwgaXRlbS5kaXNwbGF5X25hbWUpCiAgICAgICAgICBzaG93bmFtZSA9IGl0ZW0uZGlzcGxheV9uYW1lCiAgICAgICAgfQogICAgICB9KQogICAgICByZXR1cm4gc2hvd25hbWUKICAgIH0sCiAgICBwYWdpbmF0aW9uQ2hhbmdlSGFuZGxlcihwYWdlTnVtYmVyKSB7CiAgICAgIHRoaXMubGlzdFF1ZXJ5LnBhZ2UgPSBwYWdlTnVtYmVyCiAgICAgIHRoaXMuZ2V0TGlzdCgpCiAgICB9LAogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMuJHJlZnMuZm9ybS5yZXNldCgpCiAgICB9LAogICAgcmVzZXRWYWxpZGF0aW9uKCkgewogICAgICB0aGlzLiRyZWZzLmZvcm0ucmVzZXRWYWxpZGF0aW9uKCkKICAgIH0sCiAgfSwKfQo="},{"version":3,"sources":["users.vue"],"names":[],"mappings":";AA4FA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"users.vue","sourceRoot":"src/views/dashboard/settings","sourcesContent":["<template>\n  <v-container fluid class=\"px-4 py-0\">\n    <template v-slot:after-heading> </template>\n    <v-row class=\"d-flex justify-space-between mx-1 mb-5\">\n      <v-col cols=\"6\" md=\"10\">\n        <v-text-field\n          v-model=\"listQuery.name\"\n          append-icon=\"mdi-magnify\"\n          class=\"ml-auto\"\n          label=\"Search: 登录名，姓名，微信昵称\"\n          hide-details\n          single-line\n          style=\"max-width: 360px;\"\n        />\n      </v-col>\n      <!-- <v-col cols=\"6\" md=\"2\">\n          <AddBookDialog />\n        </v-col> -->\n    </v-row>\n\n    <v-divider class=\"mt-3\" />\n\n    <v-simple-table fixed-header class=\"pa-3\">\n      <template v-slot:default>\n        <thead>\n          <tr>\n            <th>ID</th>\n            <th>账号</th>\n            <th>用户名称</th>\n            <th>角色</th>\n            <th class=\"text-right\">活跃指数</th>\n            <th>手机号码</th>\n            <th>状态</th>\n            <th>创建时间</th>\n            <th>最后一次访问</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"row in items\" :key=\"row.id\">\n            <td>\n              {{ row.id }}\n            </td>\n            <td>\n              {{ row.username ? row.username : '-' }}\n            </td>\n            <td>{{ row.name ? row.name : '-' }}</td>\n            <td>\n              {{ row.role.name ? row.role.name : '-' }}\n            </td>\n            <td class=\"text-right\">\n              {{ row.login_counts }}\n            </td>\n            <td>\n              {{ row.phone ? row.phone : '-' }}\n            </td>\n            <td>\n              {{ getNamefromOptions(userStatusOptions, row.status_code) }}\n            </td>\n\n            <td>\n              {{ $moment(row.member_since).format('YYYY-MM-DD HH:mm:ss') }}\n            </td>\n            <td>\n              {{ $moment(row.last_seen).fromNow() }}\n            </td>\n          </tr>\n        </tbody>\n      </template>\n    </v-simple-table>\n    <div class=\"text-center\">\n      <v-row justify=\"center\" align=\"center\">\n        <v-pagination\n          v-model=\"listQuery.page\"\n          :circle=\"circle\"\n          :disabled=\"disabled\"\n          :length=\"total_pages\"\n          :next-icon=\"nextIcon\"\n          :prev-icon=\"prevIcon\"\n          :total-visible=\"totalVisible\"\n          :value=\"listQuery.page\"\n          @input=\"paginationChangeHandler\"\n        ></v-pagination>\n        <!-- <span>共{{total_pages}}页</span> -->\n      </v-row>\n    </div>\n    <v-snackbar v-model=\"snackbar\" :timeout=\"timeout\">\n      {{ text }}\n    </v-snackbar>\n  </v-container>\n</template>\n\n<script>\nimport { fetchUsers, deleteUser } from '@/api/users'\n\nconst userStatusOptions = [\n  { key: 0, display_name: '待审核' },\n  { key: 1, display_name: '正常' },\n  { key: 2, display_name: '未通过' },\n  { key: 3, display_name: '驳回' },\n]\n\nexport default {\n  name: 'Users',\n\n  components: {},\n\n  data: () => ({\n    snackbar: false,\n    text: '',\n    timeout: 3000,\n\n    action: {\n      color: 'info',\n      icon: 'mdi-blur',\n    },\n    items: [],\n    listQuery: {\n      page: 1,\n      limit: 100,\n      name: undefined,\n      status: undefined,\n      sort: '+id',\n    },\n    // search: undefined,\n    userStatusOptions,\n    circle: true,\n    disabled: false,\n    length: 10,\n    nextIcon: 'mdi-chevron-right',\n    prevIcon: 'mdi-chevron-left',\n    totalVisible: 10,\n    total_pages: 0,\n  }),\n  computed: {\n    isAdminRole() {\n      if (this.$store.getters.roles.includes('admin')) {\n        return true\n      } else {\n        return false\n      }\n    },\n  },\n  watch: {\n    search: function(val) {\n      if (!this.awaitingSearch) {\n        setTimeout(() => {\n          this.getList()\n          this.awaitingSearch = false\n        }, 6000) // 1 sec delay\n      }\n      this.awaitingSearch = true\n    },\n  },\n  created() {\n    this.getList()\n    // console.log()\n  },\n  methods: {\n    getQuery() {\n      setTimeout(() => this.getList(), 500)\n    },\n    getList() {\n      this.listLoading = true\n      fetchUsers(this.listQuery).then(response => {\n        this.items = response.data.items\n        this.total_pages = response.data._meta.total_pages\n        console.log(this.items)\n\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n    },\n    handleToDetails(row) {\n      // console.log(row.id)\n      this.$router.push({\n        name: '读者详情',\n        params: { id: row.id },\n      })\n    },\n    removeAuthor(row) {\n      this.$confirm('确认删除读者账号?').then(res => {\n        if (res) {\n          deleteUser(row.id).then(response => {\n            this.getList()\n            // Just to simulate the time of the request\n            this.text = '作者删除成功！'\n            this.snackbar = true\n          })\n        }\n      })\n    },\n    getNamefromOptions(options, key) {\n      // return options[key]\n      let showname = ''\n      options.forEach(item => {\n        if (item.key === key) {\n          // console.log(key, item.key, item.display_name)\n          showname = item.display_name\n        }\n      })\n      return showname\n    },\n    paginationChangeHandler(pageNumber) {\n      this.listQuery.page = pageNumber\n      this.getList()\n    },\n    reset() {\n      this.$refs.form.reset()\n    },\n    resetValidation() {\n      this.$refs.form.resetValidation()\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\nth {\n  font-size: 12px !important;\n  font-weight: 600 !important;\n}\n\ntr:hover {\n  background-color: #43b4dd !important;\n  color: rgb(255, 255, 255);\n}\n</style>\n"]}]}