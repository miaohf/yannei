{"remainingRequest":"D:\\mycode\\Yanei\\front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\mycode\\Yanei\\front-end\\node_modules\\eslint-loader\\index.js??ref--14-0!D:\\mycode\\Yanei\\front-end\\src\\permission.js","dependencies":[{"path":"D:\\mycode\\Yanei\\front-end\\src\\permission.js","mtime":1655777243395},{"path":"D:\\mycode\\Yanei\\front-end\\babel.config.js","mtime":1580387978000},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1668947705996},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1668956708481},{"path":"D:\\mycode\\Yanei\\front-end\\node_modules\\eslint-loader\\index.js","mtime":1668947802300}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiRDovbXljb2RlL1lhbmVpL2Zyb250LWVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcmVnZW5lcmF0b3JSdW50aW1lLmpzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovbXljb2RlL1lhbmVpL2Zyb250LWVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMi5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi9teWNvZGUvWWFuZWkvZnJvbnQtZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IHJvdXRlciBmcm9tICcuL3JvdXRlcic7CmltcG9ydCBzdG9yZSBmcm9tICcuL3N0b3JlJzsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICducHJvZ3Jlc3MnOyAvLyBwcm9ncmVzcyBiYXIKLy8gaW1wb3J0ICducHJvZ3Jlc3MvbnByb2dyZXNzLmNzcycgLy8gcHJvZ3Jlc3MgYmFyIHN0eWxlCmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnQC91dGlscy9hdXRoJzsgLy8gZ2V0IHRva2VuIGZyb20gY29va2llCmltcG9ydCBnZXRQYWdlVGl0bGUgZnJvbSAnQC91dGlscy9nZXQtcGFnZS10aXRsZSc7Ck5Qcm9ncmVzcy5jb25maWd1cmUoewogIHNob3dTcGlubmVyOiBmYWxzZQp9KTsgLy8gTlByb2dyZXNzIENvbmZpZ3VyYXRpb24KCnZhciB3aGl0ZUxpc3QgPSBbJy9wYWdlcy9sb2dpbicsICcvcGFnZXMvcmVnaXN0ZXInLCAnL2F1dGgtcmVkaXJlY3QnLCAnL21wL21wLzEnLCAnL21wL21wLzInLCAnL21wL21wLzMnLCAnL21wL21wLzQnLCAnL21wL21wLzUnLCAnL21wL21wLzYnLCAnL21wL21wLzcnLCAnL21wL21wLzgnLCAnL21wL21wLzknLCAnL21wL21wLzEwJywgJy9tcC9tcC8xMScsICcvbXAvbXAvMTInLCAnL21wL21wLzEzJywgJy9tcC9tcC8xNScsICcvbXAvbXAvMTYnXTsgLy8gbm8gcmVkaXJlY3Qgd2hpdGVsaXN0Cgpyb3V0ZXIuYmVmb3JlRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0bywgZnJvbSwgbmV4dCkgewogICAgdmFyIGhhc1Rva2VuLCByb2xlLCBfeWllbGQkc3RvcmUkZGlzcGF0Y2gsIF9yb2xlLCBhY2Nlc3NSb3V0ZXM7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIC8vIHN0YXJ0IHByb2dyZXNzIGJhcgogICAgICAgICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKCiAgICAgICAgICAgIC8vIHNldCBwYWdlIHRpdGxlCiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZ2V0UGFnZVRpdGxlKHRvLm1ldGEudGl0bGUpOwoKICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHVzZXIgaGFzIGxvZ2dlZCBpbgogICAgICAgICAgICBoYXNUb2tlbiA9IGdldFRva2VuKCk7CiAgICAgICAgICAgIGlmICghaGFzVG9rZW4pIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEodG8ucGF0aCA9PT0gJy9wYWdlcy9sb2dpbicpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gaWYgaXMgbG9nZ2VkIGluLCByZWRpcmVjdCB0byB0aGUgaG9tZSBwYWdlCiAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgIHBhdGg6ICcvJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHVzZXIgaGFzIG9idGFpbmVkIGhpcyBwZXJtaXNzaW9uIHJvbGVzIHRocm91Z2ggZ2V0SW5mbwogICAgICAgICAgICByb2xlID0gc3RvcmUuZ2V0dGVycy5yb2xlOwogICAgICAgICAgICBpZiAoIShyb2xlLnBlcm1pc3Npb25zICE9PSAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTQ7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCd1c2VyL2dldEluZm8nKTsKICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgIF95aWVsZCRzdG9yZSRkaXNwYXRjaCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIF9yb2xlID0gX3lpZWxkJHN0b3JlJGRpc3BhdGNoLnJvbGU7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCdwZXJtaXNzaW9uL2dlbmVyYXRlUm91dGVzJywgX3JvbGUpOwogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgYWNjZXNzUm91dGVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgLy8gZHluYW1pY2FsbHkgYWRkIGFjY2Vzc2libGUgcm91dGVzCiAgICAgICAgICAgIHJvdXRlci5hZGRSb3V0ZXMoYWNjZXNzUm91dGVzKTsKCiAgICAgICAgICAgIC8vIGhhY2sgbWV0aG9kIHRvIGVuc3VyZSB0aGF0IGFkZFJvdXRlcyBpcyBjb21wbGV0ZQogICAgICAgICAgICAvLyBzZXQgdGhlIHJlcGxhY2U6IHRydWUsIHNvIHRoZSBuYXZpZ2F0aW9uIHdpbGwgbm90IGxlYXZlIGEgaGlzdG9yeSByZWNvcmQKICAgICAgICAgICAgbmV4dChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyNjsKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxNCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzMDsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCd1c2VyL3Jlc2V0VG9rZW4nKTsKICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgIG5leHQoIi9wYWdlcy9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgLyogaGFzIG5vIHRva2VuICovCgogICAgICAgICAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgLy8gaW4gdGhlIGZyZWUgbG9naW4gd2hpdGVsaXN0LCBnbyBkaXJlY3RseQogICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBvdGhlciBwYWdlcyB0aGF0IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIGFyZSByZWRpcmVjdGVkIHRvIHRoZSBsb2dpbiBwYWdlLgogICAgICAgICAgICAgIG5leHQoIi9wYWdlcy9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSAzNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzE0LCAyNl1dKTsKICB9KSk7CiAgcmV0dXJuIGZ1bmN0aW9uIChfeCwgX3gyLCBfeDMpIHsKICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpKTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgLy8gZmluaXNoIHByb2dyZXNzIGJhcgogIE5Qcm9ncmVzcy5kb25lKCk7Cn0pOw=="},{"version":3,"names":["router","store","NProgress","getToken","getPageTitle","configure","showSpinner","whiteList","beforeEach","to","from","next","start","document","title","meta","hasToken","path","done","role","getters","permissions","dispatch","accessRoutes","addRoutes","replace","indexOf","afterEach"],"sources":["D:/mycode/Yanei/front-end/src/permission.js"],"sourcesContent":["import router from './router'\nimport store from './store'\n\nimport NProgress from 'nprogress' // progress bar\n// import 'nprogress/nprogress.css' // progress bar style\nimport { getToken } from '@/utils/auth' // get token from cookie\nimport getPageTitle from '@/utils/get-page-title'\n\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\n\nconst whiteList = [\n  '/pages/login',\n  '/pages/register',\n  '/auth-redirect',\n  '/mp/mp/1',\n  '/mp/mp/2',\n  '/mp/mp/3',\n  '/mp/mp/4',\n  '/mp/mp/5',\n  '/mp/mp/6',\n  '/mp/mp/7',\n  '/mp/mp/8',\n  '/mp/mp/9',\n  '/mp/mp/10',\n  '/mp/mp/11',\n  '/mp/mp/12',\n  '/mp/mp/13',\n  '/mp/mp/15',\n  '/mp/mp/16',\n] // no redirect whitelist\n\nrouter.beforeEach(async (to, from, next) => {\n  // start progress bar\n  NProgress.start()\n\n  // set page title\n  document.title = getPageTitle(to.meta.title)\n\n  // determine whether the user has logged in\n  const hasToken = getToken()\n\n  if (hasToken) {\n    if (to.path === '/pages/login') {\n      // if is logged in, redirect to the home page\n      next({ path: '/' })\n      NProgress.done()\n    } else {\n      // determine whether the user has obtained his permission roles through getInfo\n      const role = store.getters.role\n      if (role.permissions !== 0) {\n        next()\n      } else {\n        try {\n          // get user info\n          const { role } = await store.dispatch('user/getInfo')\n\n          // generate accessible routes map based on role\n          const accessRoutes = await store.dispatch(\n            'permission/generateRoutes',\n            role\n          )\n\n          // dynamically add accessible routes\n          router.addRoutes(accessRoutes)\n\n          // hack method to ensure that addRoutes is complete\n          // set the replace: true, so the navigation will not leave a history record\n          next({ ...to, replace: true })\n        } catch (error) {\n          // remove token and go to login page to re-login\n          await store.dispatch('user/resetToken')\n          next(`/pages/login?redirect=${to.path}`)\n          NProgress.done()\n        }\n      }\n    }\n  } else {\n    /* has no token */\n\n    if (whiteList.indexOf(to.path) !== -1) {\n      // in the free login whitelist, go directly\n      next()\n    } else {\n      // other pages that do not have permission to access are redirected to the login page.\n      next(`/pages/login?redirect=${to.path}`)\n      NProgress.done()\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  // finish progress bar\n  NProgress.done()\n})\n"],"mappings":";;;AAAA,OAAOA,MAAM,MAAM,UAAU;AAC7B,OAAOC,KAAK,MAAM,SAAS;AAE3B,OAAOC,SAAS,MAAM,WAAW,EAAC;AAClC;AACA,SAASC,QAAQ,QAAQ,cAAc,EAAC;AACxC,OAAOC,YAAY,MAAM,wBAAwB;AAEjDF,SAAS,CAACG,SAAS,CAAC;EAAEC,WAAW,EAAE;AAAM,CAAC,CAAC,EAAC;;AAE5C,IAAMC,SAAS,GAAG,CAChB,cAAc,EACd,iBAAiB,EACjB,gBAAgB,EAChB,UAAU,EACV,UAAU,EACV,UAAU,EACV,UAAU,EACV,UAAU,EACV,UAAU,EACV,UAAU,EACV,UAAU,EACV,UAAU,EACV,WAAW,EACX,WAAW,EACX,WAAW,EACX,WAAW,EACX,WAAW,EACX,WAAW,CACZ,EAAC;;AAEFP,MAAM,CAACQ,UAAU;EAAA,sEAAC,iBAAOC,EAAE,EAAEC,IAAI,EAAEC,IAAI;IAAA;IAAA;MAAA;QAAA;UAAA;YACrC;YACAT,SAAS,CAACU,KAAK,EAAE;;YAEjB;YACAC,QAAQ,CAACC,KAAK,GAAGV,YAAY,CAACK,EAAE,CAACM,IAAI,CAACD,KAAK,CAAC;;YAE5C;YACME,QAAQ,GAAGb,QAAQ,EAAE;YAAA,KAEvBa,QAAQ;cAAA;cAAA;YAAA;YAAA,MACNP,EAAE,CAACQ,IAAI,KAAK,cAAc;cAAA;cAAA;YAAA;YAC5B;YACAN,IAAI,CAAC;cAAEM,IAAI,EAAE;YAAI,CAAC,CAAC;YACnBf,SAAS,CAACgB,IAAI,EAAE;YAAA;YAAA;UAAA;YAEhB;YACMC,IAAI,GAAGlB,KAAK,CAACmB,OAAO,CAACD,IAAI;YAAA,MAC3BA,IAAI,CAACE,WAAW,KAAK,CAAC;cAAA;cAAA;YAAA;YACxBV,IAAI,EAAE;YAAA;YAAA;UAAA;YAAA;YAAA;YAAA,OAImBV,KAAK,CAACqB,QAAQ,CAAC,cAAc,CAAC;UAAA;YAAA;YAA7CH,KAAI,yBAAJA,IAAI;YAAA;YAAA,OAGelB,KAAK,CAACqB,QAAQ,CACvC,2BAA2B,EAC3BH,KAAI,CACL;UAAA;YAHKI,YAAY;YAKlB;YACAvB,MAAM,CAACwB,SAAS,CAACD,YAAY,CAAC;;YAE9B;YACA;YACAZ,IAAI,iCAAMF,EAAE;cAAEgB,OAAO,EAAE;YAAI,GAAG;YAAA;YAAA;UAAA;YAAA;YAAA;YAAA;YAAA,OAGxBxB,KAAK,CAACqB,QAAQ,CAAC,iBAAiB,CAAC;UAAA;YACvCX,IAAI,iCAA0BF,EAAE,CAACQ,IAAI,EAAG;YACxCf,SAAS,CAACgB,IAAI,EAAE;UAAA;YAAA;YAAA;UAAA;YAKtB;;YAEA,IAAIX,SAAS,CAACmB,OAAO,CAACjB,EAAE,CAACQ,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;cACrC;cACAN,IAAI,EAAE;YACR,CAAC,MAAM;cACL;cACAA,IAAI,iCAA0BF,EAAE,CAACQ,IAAI,EAAG;cACxCf,SAAS,CAACgB,IAAI,EAAE;YAClB;UAAC;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAEJ;EAAA;IAAA;EAAA;AAAA,IAAC;AAEFlB,MAAM,CAAC2B,SAAS,CAAC,YAAM;EACrB;EACAzB,SAAS,CAACgB,IAAI,EAAE;AAClB,CAAC,CAAC"}]}